<template>
  <div class="dashboard">
    <!-- æ¬¢è¿åŒºåŸŸ -->
    <div class="welcome-section">
      <div class="welcome-bg">
        <div class="bg-shape shape-1"></div>
        <div class="bg-shape shape-2"></div>
        <div class="bg-shape shape-3"></div>
      </div>
      <div class="welcome-content">
        <h1 class="welcome-title">
          æ¬¢è¿ä½¿ç”¨ TradingAgents-CN
          <span class="version-badge">v1.0.0-preview</span>
        </h1>
        <p class="welcome-subtitle">
          ç°ä»£åŒ–çš„å¤šæ™ºèƒ½ä½“è‚¡ç¥¨åˆ†æå­¦ä¹ å¹³å°ï¼Œè¾…åŠ©ä½ æŒæ¡æ›´å…¨é¢çš„å¸‚åœºè§†è§’åˆ†æè‚¡ç¥¨
        </p>
      </div>
      <div class="welcome-actions">
        <el-button type="primary" size="large" class="action-btn primary-btn" @click="quickAnalysis">
          <el-icon><TrendCharts /></el-icon>
          å¿«é€Ÿåˆ†æ
        </el-button>
        <el-button size="large" class="action-btn secondary-btn" @click="goToScreening">
          <el-icon><Search /></el-icon>
          è‚¡ç¥¨ç­›é€‰
        </el-button>
      </div>
    </div>

    <!-- å­¦ä¹ ä¸­å¿ƒæ¨èå¡ç‰‡ -->
    <el-card class="learning-highlight-card">
      <div class="learning-highlight">
        <div class="learning-icon">
          <el-icon size="40"><Reading /></el-icon>
        </div>
        <div class="learning-content">
          <h2>ğŸ“š AIè‚¡ç¥¨åˆ†æå­¦ä¹ ä¸­å¿ƒ</h2>
          <p>ä»é›¶å¼€å§‹å­¦ä¹ AIã€å¤§è¯­è¨€æ¨¡å‹å’Œæ™ºèƒ½è‚¡ç¥¨åˆ†æã€‚äº†è§£å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå¦‚ä½•åä½œåˆ†æè‚¡ç¥¨ï¼ŒæŒæ¡æç¤ºè¯å·¥ç¨‹æŠ€å·§ï¼Œé€‰æ‹©åˆé€‚çš„å¤§æ¨¡å‹ï¼Œç†è§£AIçš„èƒ½åŠ›ä¸å±€é™æ€§ã€‚</p>
          <div class="learning-features">
            <span class="feature-tag">ğŸ¤– AIåŸºç¡€çŸ¥è¯†</span>
            <span class="feature-tag">âœï¸ æç¤ºè¯å·¥ç¨‹</span>
            <span class="feature-tag">ğŸ¯ æ¨¡å‹é€‰æ‹©</span>
            <span class="feature-tag">ğŸ“Š åˆ†æåŸç†</span>
            <span class="feature-tag">âš ï¸ é£é™©è®¤çŸ¥</span>
            <span class="feature-tag">ğŸ“ å®æˆ˜æ•™ç¨‹</span>
          </div>
        </div>
        <div class="learning-action">
          <el-button type="primary" size="large" @click="goToLearning">
            <el-icon><Reading /></el-icon>
            å¼€å§‹å­¦ä¹ 
          </el-button>
        </div>
      </div>
    </el-card>

    <!-- ä¸»è¦åŠŸèƒ½åŒºåŸŸ -->
    <el-row :gutter="24" class="main-content">
      <!-- å·¦ä¾§ï¼šå¿«é€Ÿæ“ä½œ -->
      <el-col :xs="24" :sm="24" :md="16" :lg="16">
        <el-card class="quick-actions-card">
          <template #header>
            <div class="card-header-title">
              <span class="title-icon">âš¡</span>
              å¿«é€Ÿæ“ä½œ
            </div>
          </template>
          <div class="quick-actions">
            <div class="action-item" @click="goToSingleAnalysis">
              <div class="action-icon gradient-blue">
                <el-icon><Document /></el-icon>
              </div>
              <div class="action-content">
                <h3>å•è‚¡åˆ†æ</h3>
                <p>æ·±åº¦åˆ†æå•åªè‚¡ç¥¨çš„æŠ•èµ„ä»·å€¼</p>
              </div>
              <el-icon class="action-arrow"><ArrowRight /></el-icon>
            </div>

            <div class="action-item" @click="goToBatchAnalysis">
              <div class="action-icon gradient-purple">
                <el-icon><Files /></el-icon>
              </div>
              <div class="action-content">
                <h3>æ‰¹é‡åˆ†æ</h3>
                <p>åŒæ—¶åˆ†æå¤šåªè‚¡ç¥¨ï¼Œæé«˜æ•ˆç‡</p>
              </div>
              <el-icon class="action-arrow"><ArrowRight /></el-icon>
            </div>

            <div class="action-item" @click="goToScreening">
              <div class="action-icon gradient-green">
                <el-icon><Search /></el-icon>
              </div>
              <div class="action-content">
                <h3>è‚¡ç¥¨ç­›é€‰</h3>
                <p>é€šè¿‡å¤šç»´åº¦æ¡ä»¶ç­›é€‰ä¼˜è´¨è‚¡ç¥¨</p>
              </div>
              <el-icon class="action-arrow"><ArrowRight /></el-icon>
            </div>

            <div class="action-item" @click="goToQueue">
              <div class="action-icon gradient-orange">
                <el-icon><List /></el-icon>
              </div>
              <div class="action-content">
                <h3>ä»»åŠ¡ä¸­å¿ƒ</h3>
                <p>æŸ¥çœ‹å’Œç®¡ç†åˆ†æä»»åŠ¡åˆ—è¡¨</p>
              </div>
              <el-icon class="action-arrow"><ArrowRight /></el-icon>
            </div>
          </div>
        </el-card>

        <!-- æœ€è¿‘åˆ†æ -->
        <el-card class="recent-analyses-card" style="margin-top: 24px;">
          <template #header>
            <div class="card-header-title">
              <span class="title-icon">ğŸ“Š</span>
              æœ€è¿‘åˆ†æ
            </div>
          </template>
          <el-table :data="recentAnalyses" style="width: 100%" class="custom-table">
            <el-table-column prop="stock_code" label="è‚¡ç¥¨ä»£ç " width="120">
              <template #default="{ row }">
                <span class="stock-code-cell">{{ row.stock_code }}</span>
              </template>
            </el-table-column>
            <el-table-column prop="stock_name" label="è‚¡ç¥¨åç§°" width="150" />
            <el-table-column prop="status" label="çŠ¶æ€" width="100">
              <template #default="{ row }">
                <el-tag :type="getStatusType(row.status)" class="status-tag">
                  {{ getStatusText(row.status) }}
                </el-tag>
              </template>
            </el-table-column>
            <el-table-column prop="start_time" label="åˆ›å»ºæ—¶é—´" width="180">
              <template #default="{ row }">
                <span class="time-cell">{{ formatTime(row.start_time) }}</span>
              </template>
            </el-table-column>
            <el-table-column label="æ“ä½œ">
              <template #default="{ row }">
                <el-button type="primary" link size="small" @click="viewAnalysis(row)">
                  æŸ¥çœ‹
                </el-button>
                <el-button
                  v-if="row.status === 'completed'"
                  type="success" link
                  size="small"
                  @click="downloadReport(row)"
                >
                  ä¸‹è½½
                </el-button>
              </template>
            </el-table-column>
          </el-table>

          <div class="table-footer">
            <el-button type="primary" link @click="goToHistory">
              æŸ¥çœ‹å…¨éƒ¨å†å² <el-icon><ArrowRight /></el-icon>
            </el-button>
          </div>
        </el-card>

        <!-- å¸‚åœºå¿«è®¯ -->
        <el-card class="market-news-card" style="margin-top: 24px;">
          <template #header>
            <div class="card-header-title">
              <span class="title-icon">ğŸ“°</span>
              å¸‚åœºå¿«è®¯
            </div>
          </template>
          <div v-if="marketNews.length > 0" class="news-list">
            <div
              v-for="news in marketNews"
              :key="news.id"
              class="news-item"
              @click="openNewsUrl(news.url)"
            >
              <div class="news-content">
                <div class="news-title">{{ news.title }}</div>
                <div class="news-meta">
                  <span class="news-source" v-if="news.source">{{ news.source }}</span>
                  <span class="news-time">{{ formatTime(news.time) }}</span>
                </div>
              </div>
              <el-icon class="news-arrow"><ArrowRight /></el-icon>
            </div>
          </div>
          <div v-else class="empty-state">
            <el-icon class="empty-icon"><InfoFilled /></el-icon>
            <p>æš‚æ— å¸‚åœºå¿«è®¯</p>
          </div>
        </el-card>
      </el-col>

      <!-- å³ä¾§ï¼šè‡ªé€‰è‚¡å’Œå¿«è®¯ -->
      <el-col :xs="24" :sm="24" :md="8" :lg="8">
        <!-- æˆ‘çš„è‡ªé€‰è‚¡ -->
        <el-card class="favorites-card">
          <template #header>
            <div class="card-header">
              <div class="card-header-title">
                <span class="title-icon">â­</span>
                æˆ‘çš„è‡ªé€‰è‚¡
              </div>
              <el-button type="primary" link size="small" @click="goToFavorites">
                æŸ¥çœ‹å…¨éƒ¨ <el-icon><ArrowRight /></el-icon>
              </el-button>
            </div>
          </template>

          <div v-if="favoriteStocks.length === 0" class="empty-favorites">
            <el-empty description="æš‚æ— è‡ªé€‰è‚¡" :image-size="60">
              <el-button type="primary" size="small" @click="goToFavorites">
                æ·»åŠ è‡ªé€‰è‚¡
              </el-button>
            </el-empty>
          </div>

          <div v-else class="favorites-list">
            <div
              v-for="stock in favoriteStocks.slice(0, 5)"
              :key="stock.stock_code"
              class="favorite-item"
              @click="viewStockDetail(stock)"
            >
              <div class="stock-info">
                <div class="stock-code">{{ stock.stock_code }}</div>
                <div class="stock-name">{{ stock.stock_name }}</div>
              </div>
              <div class="stock-price">
                <div class="current-price">Â¥{{ stock.current_price }}</div>
                <div
                  class="change-percent"
                  :class="getPriceChangeClass(stock.change_percent)"
                >
                  {{ stock.change_percent > 0 ? '+' : '' }}{{ Number(stock.change_percent).toFixed(2) }}%
                </div>
              </div>
            </div>
          </div>

          <div v-if="favoriteStocks.length > 5" class="favorites-footer">
            <el-button type="primary" link size="small" @click="goToFavorites">
              æŸ¥çœ‹å…¨éƒ¨ {{ favoriteStocks.length }} åªè‡ªé€‰è‚¡
            </el-button>
          </div>
        </el-card>

        <!-- æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ· -->
        <el-card class="paper-trading-card" style="margin-top: 24px;">
          <template #header>
            <div class="card-header">
              <div class="card-header-title">
                <span class="title-icon">ğŸ’°</span>
                æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·
              </div>
              <el-button type="primary" link size="small" @click="goToPaperTrading">
                æŸ¥çœ‹è¯¦æƒ… <el-icon><ArrowRight /></el-icon>
              </el-button>
            </div>
          </template>

          <div v-if="paperAccount" class="paper-account-info">
            <!-- Aè‚¡è´¦æˆ· -->
            <div class="account-section">
              <div class="account-section-title">ğŸ‡¨ğŸ‡³ Aè‚¡è´¦æˆ·</div>
              <div class="account-item">
                <div class="account-label">ç°é‡‘</div>
                <div class="account-value">Â¥{{ formatMoney(paperAccount.cash?.CNY || paperAccount.cash) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æŒä»“å¸‚å€¼</div>
                <div class="account-value">Â¥{{ formatMoney(paperAccount.positions_value?.CNY || paperAccount.positions_value) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æ€»èµ„äº§</div>
                <div class="account-value primary">Â¥{{ formatMoney(paperAccount.equity?.CNY || paperAccount.equity) }}</div>
              </div>
            </div>

            <!-- æ¸¯è‚¡è´¦æˆ· -->
            <div class="account-section" v-if="paperAccount.cash?.HKD !== undefined">
              <div class="account-section-title">ğŸ‡­ğŸ‡° æ¸¯è‚¡è´¦æˆ·</div>
              <div class="account-item">
                <div class="account-label">ç°é‡‘</div>
                <div class="account-value">HK${{ formatMoney(paperAccount.cash.HKD) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æŒä»“å¸‚å€¼</div>
                <div class="account-value">HK${{ formatMoney(paperAccount.positions_value?.HKD || 0) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æ€»èµ„äº§</div>
                <div class="account-value primary">HK${{ formatMoney(paperAccount.equity?.HKD || 0) }}</div>
              </div>
            </div>

            <!-- ç¾è‚¡è´¦æˆ· -->
            <div class="account-section" v-if="paperAccount.cash?.USD !== undefined">
              <div class="account-section-title">ğŸ‡ºğŸ‡¸ ç¾è‚¡è´¦æˆ·</div>
              <div class="account-item">
                <div class="account-label">ç°é‡‘</div>
                <div class="account-value">${{ formatMoney(paperAccount.cash.USD) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æŒä»“å¸‚å€¼</div>
                <div class="account-value">${{ formatMoney(paperAccount.positions_value?.USD || 0) }}</div>
              </div>
              <div class="account-item">
                <div class="account-label">æ€»èµ„äº§</div>
                <div class="account-value primary">${{ formatMoney(paperAccount.equity?.USD || 0) }}</div>
              </div>
            </div>
          </div>

          <div v-else class="empty-state">
            <el-icon class="empty-icon"><InfoFilled /></el-icon>
            <p>æš‚æ— è´¦æˆ·ä¿¡æ¯</p>
            <el-button type="primary" size="small" @click="goToPaperTrading">
              æŸ¥çœ‹æ¨¡æ‹Ÿäº¤æ˜“
            </el-button>
          </div>
        </el-card>

        <!-- å¤šæ•°æ®æºåŒæ­¥ -->
        <MultiSourceSyncCard style="margin-top: 24px;" />
      </el-col>
    </el-row>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import {
  TrendCharts,
  Search,
  Document,
  Files,
  List,
  ArrowRight,
  InfoFilled,
  Reading
} from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import type { AnalysisTask, AnalysisStatus } from '@/types/analysis'
import MultiSourceSyncCard from '@/components/Dashboard/MultiSourceSyncCard.vue'
import { favoritesApi } from '@/api/favorites'
import { analysisApi } from '@/api/analysis'
import { newsApi } from '@/api/news'
import { paperApi, type PaperAccountSummary } from '@/api/paper'

const router = useRouter()
const authStore = useAuthStore()

// å“åº”å¼æ•°æ®
const userStats = ref({
  totalAnalyses: 0,
  successfulAnalyses: 0,
  dailyQuota: 1000,
  dailyUsed: 0,
  concurrentLimit: 3
})

const systemStatus = ref({
  api: true,
  queue: true,
  database: true
})

const queueStats = ref({
  pending: 0,
  processing: 0,
  completed: 0,
  failed: 0
})

const recentAnalyses = ref<AnalysisTask[]>([])

// è‡ªé€‰è‚¡æ•°æ®
const favoriteStocks = ref<any[]>([])

// å¸‚åœºå¿«è®¯æ•°æ®
const marketNews = ref<any[]>([])
const syncingNews = ref(false)

// æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·æ•°æ®
const paperAccount = ref<PaperAccountSummary | null>(null)



// æ–¹æ³•
const quickAnalysis = () => {
  router.push('/analysis/single')
}

const goToSingleAnalysis = () => {
  router.push('/analysis/single')
}

const goToBatchAnalysis = () => {
  router.push('/analysis/batch')
}

const goToScreening = () => {
  router.push('/screening')
}

const goToQueue = () => {
  router.push('/queue')
}

const goToHistory = () => {
  router.push('/tasks?tab=completed')
}

const goToLearning = () => {
  router.push('/learning')
}

const viewAnalysis = (analysis: AnalysisTask) => {
  const status = (analysis as any)?.status
  if (status === 'completed') {
    router.push({ name: 'ReportDetail', params: { id: analysis.task_id } })
  } else {
    // æœªå®Œæˆä»»åŠ¡è·³è½¬åˆ°ä»»åŠ¡ä¸­å¿ƒçš„"è¿›è¡Œä¸­"æ ‡ç­¾é¡µ
    router.push('/tasks?tab=running')
  }
}

const downloadReport = async (analysis: AnalysisTask) => {
  try {
    const reportId = analysis.task_id
    const res = await fetch(`/api/reports/${reportId}/download?format=markdown`, {
      headers: {
        'Authorization': `Bearer ${authStore.token}`
      }
    })
    if (!res.ok) {
      const msg = `ä¸‹è½½å¤±è´¥ï¼šHTTP ${res.status}`
      console.error(msg)
      ElMessage.error('ä¸‹è½½å¤±è´¥ï¼ŒæŠ¥å‘Šå¯èƒ½å°šæœªç”Ÿæˆ')
      return
    }
    const blob = await res.blob()
    const url = window.URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    const code = (analysis as any).stock_code || (analysis as any).stock_symbol || 'stock'
    const dateStr = (analysis as any).analysis_date || (analysis as any).start_time || ''
    a.download = `${code}_åˆ†ææŠ¥å‘Š_${String(dateStr).slice(0,10)}.md`
    document.body.appendChild(a)
    a.click()
    window.URL.revokeObjectURL(url)
    document.body.removeChild(a)
    ElMessage.success('æŠ¥å‘Šå·²å¼€å§‹ä¸‹è½½')
  } catch (err) {
    console.error('ä¸‹è½½æŠ¥å‘Šå‡ºé”™:', err)
    ElMessage.error('ä¸‹è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  }
}

const openNewsUrl = (url?: string) => {
  if (url) {
    window.open(url, '_blank')
  } else {
    ElMessage.info('è¯¥æ–°é—»æš‚æ— è¯¦æƒ…é“¾æ¥')
  }
}

const getStatusType = (status: string | AnalysisStatus): 'success' | 'info' | 'warning' | 'danger' => {
  const statusMap: Record<string, 'success' | 'info' | 'warning' | 'danger'> = {
    pending: 'info',
    processing: 'warning',
    running: 'warning',
    completed: 'success',
    failed: 'danger',
    cancelled: 'info'
  }
  return statusMap[status] || 'info'
}

const getStatusText = (status: string | AnalysisStatus) => {
  const statusMap: Record<string, string> = {
    pending: 'ç­‰å¾…ä¸­',
    processing: 'å¤„ç†ä¸­',
    running: 'å¤„ç†ä¸­',
    completed: 'å·²å®Œæˆ',
    failed: 'å¤±è´¥',
    cancelled: 'å·²å–æ¶ˆ'
  }
  return statusMap[status] || String(status)
}

import { formatDateTime } from '@/utils/datetime'

const formatTime = (time: string) => {
  return formatDateTime(time)
}

// è‡ªé€‰è‚¡ç›¸å…³æ–¹æ³•
const goToFavorites = () => {
  router.push('/favorites')
}

const viewStockDetail = (stock: any) => {
  router.push(`/analysis/single?stock_code=${stock.stock_code}`)
}

const getPriceChangeClass = (changePercent: number) => {
  if (changePercent > 0) return 'price-up'
  if (changePercent < 0) return 'price-down'
  return 'price-neutral'
}

const loadFavoriteStocks = async () => {
  try {
    const response = await favoritesApi.list()
    if (response.success && response.data) {
      favoriteStocks.value = response.data.map((item: any) => ({
        stock_code: item.stock_code,
        stock_name: item.stock_name,
        current_price: item.current_price || 0,
        change_percent: item.change_percent || 0
      }))
    }
  } catch (error) {
    console.error('åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:', error)
  }
}

const loadRecentAnalyses = async () => {
  try {
    const res = await analysisApi.getTaskList({
      limit: 10,
      offset: 0,
      status: undefined
    })

    const body: any = (res as any)?.data?.data || (res as any)?.data || res || {}
    const tasks = body.tasks || []

    recentAnalyses.value = tasks
    userStats.value.totalAnalyses = body.total ?? tasks.length
    userStats.value.successfulAnalyses = tasks.filter((item: any) => item.status === 'completed').length
  } catch (error) {
    console.error('åŠ è½½æœ€è¿‘åˆ†æå¤±è´¥:', error)
    recentAnalyses.value = []
  }
}

const loadMarketNews = async () => {
  try {
    let response = await newsApi.getLatestNews(undefined, 10, 24)

    if (response.success && response.data && response.data.news.length === 0) {
      console.log('æœ€è¿‘ 24 å°æ—¶æ²¡æœ‰æ–°é—»ï¼Œè·å–æœ€æ–°çš„ 10 æ¡æ–°é—»ï¼ˆä¸é™æ—¶é—´ï¼‰')
      response = await newsApi.getLatestNews(undefined, 10, 24 * 365)
    }

    if (response.success && response.data) {
      marketNews.value = response.data.news.map((item: any) => ({
        id: item.id || item.title,
        title: item.title,
        time: item.publish_time,
        url: item.url,
        source: item.source
      }))
    }
  } catch (error) {
    console.error('åŠ è½½å¸‚åœºå¿«è®¯å¤±è´¥:', error)
    marketNews.value = []
  }
}

// åŠ è½½æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·ä¿¡æ¯
const loadPaperAccount = async () => {
  try {
    const response = await paperApi.getAccount()
    if (response.success && response.data) {
      paperAccount.value = response.data.account
    }
  } catch (error) {
    console.error('åŠ è½½æ¨¡æ‹Ÿäº¤æ˜“è´¦æˆ·å¤±è´¥:', error)
    paperAccount.value = null
  }
}

// è·³è½¬åˆ°æ¨¡æ‹Ÿäº¤æ˜“é¡µé¢
const goToPaperTrading = () => {
  router.push('/paper')
}

// æ ¼å¼åŒ–é‡‘é¢
const formatMoney = (value: number) => {
  return value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')
}

// è·å–ç›ˆäºæ ·å¼ç±»
const getPnlClass = (pnl: number) => {
  if (pnl > 0) return 'price-up'
  if (pnl < 0) return 'price-down'
  return 'price-neutral'
}

const syncMarketNews = async () => {
  try {
    syncingNews.value = true
    ElMessage.info('æ­£åœ¨åŒæ­¥å¸‚åœºæ–°é—»ï¼Œè¯·ç¨å€™...')

    const response = await newsApi.syncMarketNews(24, 50)

    if (response.success) {
      ElMessage.success('æ–°é—»åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨ï¼Œè¯·ç¨ååˆ·æ–°æŸ¥çœ‹')

      setTimeout(async () => {
        await loadMarketNews()
        if (marketNews.value.length > 0) {
          ElMessage.success(`æˆåŠŸåŠ è½½ ${marketNews.value.length} æ¡å¸‚åœºæ–°é—»`)
        }
      }, 3000)
    }
  } catch (error) {
    console.error('åŒæ­¥å¸‚åœºå¿«è®¯å¤±è´¥:', error)
    ElMessage.error('åŒæ­¥å¸‚åœºæ–°é—»å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  } finally {
    syncingNews.value = false
  }
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(async () => {
  await loadFavoriteStocks()
  await loadRecentAnalyses()
  await loadMarketNews()
  await loadPaperAccount()
})
</script>

<style lang="scss" scoped>
.dashboard {
  // æ¬¢è¿åŒºåŸŸ
  .welcome-section {
    position: relative;
    background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 50%, #EC4899 100%);
    border-radius: 20px;
    padding: 48px 40px;
    color: white;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(79, 70, 229, 0.3);

    .welcome-bg {
      position: absolute;
      inset: 0;
      overflow: hidden;

      .bg-shape {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        animation: float 20s ease-in-out infinite;

        &.shape-1 {
          width: 300px;
          height: 300px;
          top: -100px;
          right: -50px;
          animation-delay: 0s;
        }

        &.shape-2 {
          width: 200px;
          height: 200px;
          bottom: -80px;
          left: 20%;
          animation-delay: -5s;
        }

        &.shape-3 {
          width: 150px;
          height: 150px;
          top: 50%;
          right: 30%;
          animation-delay: -10s;
        }
      }
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(20px, -20px) scale(1.05); }
      50% { transform: translate(-10px, 10px) scale(0.95); }
      75% { transform: translate(-20px, -10px) scale(1.02); }
    }

    .welcome-content {
      position: relative;
      z-index: 1;

      .welcome-title {
        font-size: 36px;
        font-weight: 700;
        margin: 0 0 16px 0;
        display: flex;
        align-items: center;
        gap: 16px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);

        .version-badge {
          background: rgba(255, 255, 255, 0.2);
          backdrop-filter: blur(10px);
          padding: 6px 16px;
          border-radius: 20px;
          font-size: 14px;
          font-weight: 500;
          border: 1px solid rgba(255, 255, 255, 0.3);
        }
      }

      .welcome-subtitle {
        font-size: 18px;
        opacity: 0.9;
        margin: 0;
        max-width: 500px;
        line-height: 1.6;
      }
    }

    .welcome-actions {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 16px;

      .action-btn {
        height: 48px;
        padding: 0 28px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;

        &.primary-btn {
          background: white !important;
          color: #4F46E5 !important;
          border: none !important;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;

          &:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3) !important;
          }
        }

        &.secondary-btn {
          background: rgba(255, 255, 255, 0.15) !important;
          color: white !important;
          border: 1px solid rgba(255, 255, 255, 0.3) !important;
          backdrop-filter: blur(10px);

          &:hover {
            background: rgba(255, 255, 255, 0.25) !important;
            transform: translateY(-2px);
          }
        }
      }
    }
  }

  // å­¦ä¹ ä¸­å¿ƒå¡ç‰‡
  .learning-highlight-card {
    margin-bottom: 24px;
    border: 2px solid transparent;
    background: linear-gradient(var(--el-bg-color), var(--el-bg-color)) padding-box,
                linear-gradient(135deg, #4F46E5, #7C3AED, #EC4899) border-box;
    border-radius: 16px !important;

    &:hover {
      transform: none;
    }

    .learning-highlight {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 8px;

      .learning-icon {
        flex-shrink: 0;
        width: 80px;
        height: 80px;
        border-radius: 16px;
        background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
      }

      .learning-content {
        flex: 1;

        h2 {
          font-size: 20px;
          font-weight: 700;
          margin: 0 0 12px 0;
          color: var(--el-text-color-primary);
        }

        p {
          font-size: 14px;
          color: var(--el-text-color-regular);
          line-height: 1.6;
          margin: 0 0 16px 0;
        }

        .learning-features {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;

          .feature-tag {
            padding: 6px 14px;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
            color: #4F46E5;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;

            &:hover {
              background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(124, 58, 237, 0.2));
              transform: translateY(-1px);
            }
          }
        }
      }

      .learning-action {
        flex-shrink: 0;
      }
    }
  }

  // å¡ç‰‡æ ‡é¢˜æ ·å¼
  .card-header-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
    color: var(--el-text-color-primary);

    .title-icon {
      font-size: 18px;
    }
  }

  // å¿«é€Ÿæ“ä½œå¡ç‰‡
  .quick-actions-card {
    &:hover {
      transform: none;
    }

    .quick-actions {
      display: grid;
      gap: 16px;

      .action-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 20px;
        border: 1px solid var(--el-border-color-lighter);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: var(--el-bg-color);

        &:hover {
          border-color: var(--el-color-primary);
          background: linear-gradient(to right, rgba(79, 70, 229, 0.05), transparent);
          transform: translateX(4px);

          .action-arrow {
            transform: translateX(4px);
            color: var(--el-color-primary);
          }
        }

        .action-icon {
          width: 48px;
          height: 48px;
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 22px;
          flex-shrink: 0;

          &.gradient-blue {
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
          }

          &.gradient-purple {
            background: linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
          }

          &.gradient-green {
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
          }

          &.gradient-orange {
            background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
          }
        }

        .action-content {
          flex: 1;

          h3 {
            margin: 0 0 4px 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--el-text-color-primary);
          }

          p {
            margin: 0;
            font-size: 14px;
            color: var(--el-text-color-secondary);
          }
        }

        .action-arrow {
          color: var(--el-text-color-placeholder);
          transition: all 0.3s ease;
          font-size: 16px;
        }
      }
    }
  }

  // æœ€è¿‘åˆ†æå¡ç‰‡
  .recent-analyses-card {
    &:hover {
      transform: none;
    }

    .custom-table {
      .stock-code-cell {
        font-weight: 600;
        color: var(--el-color-primary);
      }

      .time-cell {
        color: var(--el-text-color-secondary);
        font-size: 13px;
      }

      .status-tag {
        font-weight: 500;
      }
    }

    .table-footer {
      text-align: center;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--el-border-color-lighter);
    }
  }

  // å¸‚åœºå¿«è®¯å¡ç‰‡
  .market-news-card {
    &:hover {
      transform: none;
    }

    .news-list {
      .news-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 0;
        cursor: pointer;
        border-bottom: 1px solid var(--el-border-color-lighter);
        transition: all 0.2s ease;

        &:last-child {
          border-bottom: none;
        }

        &:hover {
          background: linear-gradient(to right, rgba(79, 70, 229, 0.05), transparent);
          margin: 0 -20px;
          padding: 14px 20px;
          border-radius: 8px;

          .news-arrow {
            opacity: 1;
            transform: translateX(0);
          }
        }

        .news-content {
          flex: 1;

          .news-title {
            font-size: 14px;
            color: var(--el-text-color-primary);
            margin-bottom: 6px;
            line-height: 1.5;
            font-weight: 500;
          }

          .news-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--el-text-color-placeholder);

            .news-source {
              padding: 2px 8px;
              background: var(--el-fill-color-light);
              border-radius: 4px;
            }
          }
        }

        .news-arrow {
          color: var(--el-text-color-placeholder);
          opacity: 0;
          transform: translateX(-10px);
          transition: all 0.2s ease;
        }
      }
    }
  }

  // è‡ªé€‰è‚¡å¡ç‰‡
  .favorites-card {
    &:hover {
      transform: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .empty-favorites {
      text-align: center;
      padding: 20px 0;
    }

    .favorites-list {
      .favorite-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 0;
        border-bottom: 1px solid var(--el-border-color-lighter);
        cursor: pointer;
        transition: all 0.2s ease;

        &:hover {
          background: linear-gradient(to right, rgba(79, 70, 229, 0.05), transparent);
          margin: 0 -20px;
          padding: 14px 20px;
          border-radius: 8px;
        }

        &:last-child {
          border-bottom: none;
        }

        .stock-info {
          .stock-code {
            font-weight: 600;
            font-size: 14px;
            color: var(--el-color-primary);
          }

          .stock-name {
            font-size: 12px;
            color: var(--el-text-color-secondary);
            margin-top: 4px;
          }
        }

        .stock-price {
          text-align: right;

          .current-price {
            font-weight: 600;
            font-size: 15px;
            color: var(--el-text-color-primary);
          }

          .change-percent {
            font-size: 13px;
            margin-top: 4px;
            font-weight: 500;

            &.price-up {
              color: #EF4444;
            }

            &.price-down {
              color: #10B981;
            }

            &.price-neutral {
              color: var(--el-text-color-secondary);
            }
          }
        }
      }
    }

    .favorites-footer {
      text-align: center;
      padding-top: 12px;
      border-top: 1px solid var(--el-border-color-lighter);
      margin-top: 12px;
    }
  }

  // æ¨¡æ‹Ÿäº¤æ˜“å¡ç‰‡
  .paper-trading-card {
    &:hover {
      transform: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .paper-account-info {
      display: flex;
      flex-direction: column;
      gap: 16px;

      .account-section {
        border: 1px solid var(--el-border-color-lighter);
        border-radius: 12px;
        padding: 16px;
        background: linear-gradient(to right, var(--el-fill-color-lighter), transparent);

        .account-section-title {
          font-size: 14px;
          font-weight: 600;
          color: var(--el-text-color-primary);
          margin-bottom: 12px;
          padding-bottom: 10px;
          border-bottom: 1px solid var(--el-border-color-lighter);
        }
      }

      .account-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;

        .account-label {
          font-size: 13px;
          color: var(--el-text-color-secondary);
        }

        .account-value {
          font-size: 15px;
          font-weight: 600;
          color: var(--el-text-color-primary);

          &.primary {
            color: var(--el-color-primary);
            font-size: 17px;
          }

          &.price-up {
            color: #EF4444;
          }

          &.price-down {
            color: #10B981;
          }
        }
      }
    }

    .empty-state {
      text-align: center;
      padding: 24px 0;

      .empty-icon {
        font-size: 48px;
        color: var(--el-text-color-placeholder);
        margin-bottom: 12px;
      }

      p {
        color: var(--el-text-color-secondary);
        margin-bottom: 16px;
      }
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .dashboard {
    .welcome-section {
      flex-direction: column;
      text-align: center;
      gap: 24px;
      padding: 32px 24px;

      .welcome-content {
        .welcome-title {
          font-size: 24px;
          flex-direction: column;
          gap: 12px;
        }

        .welcome-subtitle {
          font-size: 14px;
        }
      }

      .welcome-actions {
        justify-content: center;
        flex-wrap: wrap;
      }
    }

    .learning-highlight-card {
      .learning-highlight {
        flex-direction: column;
        text-align: center;

        .learning-content {
          .learning-features {
            justify-content: center;
          }
        }
      }
    }

    .main-content {
      .el-col {
        margin-bottom: 24px;
      }
    }
  }
}

// æš—è‰²ä¸»é¢˜é€‚é…
html.dark {
  .dashboard {
    .welcome-section {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .learning-highlight-card {
      .learning-highlight {
        .learning-content {
          .learning-features {
            .feature-tag {
              background: linear-gradient(135deg, rgba(129, 140, 248, 0.15), rgba(167, 139, 250, 0.15));
              color: #A5B4FC;
            }
          }
        }
      }
    }

    .quick-actions-card {
      .action-item {
        &:hover {
          background: linear-gradient(to right, rgba(129, 140, 248, 0.1), transparent);
        }
      }
    }
  }
}
</style>
